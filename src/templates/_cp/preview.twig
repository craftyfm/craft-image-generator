{% set Image = element.getGeneratedImage() %}

<div class="meta -image-preview">
    <div class="heading">
        <label>{{ " Image"|t('-image-generator') }}</label>
    </div>

    <div class="-image-content">
        {% if Image %}
            <div class="-image-thumbnail">
                <img src="{{ Image.getUrl('transform') }}"
                     alt=" Image for {{ element.title }}"
                     style="max-width: 200px; height: auto; border: 1px solid #e3e5e8; border-radius: 4px;">
                <p class="light">
                    <small>{{ Image.filename }} ({{ Image.size|filesize }})</small>
                </p>
            </div>
        {% else %}
            <div class="-image-placeholder">
                <p class="light">{{ "No  image generated yet"|t('-image-generator') }}</p>
            </div>
        {% endif %}

        <div class="-image-actions">
            <button type="button"
                    class="btn small -generate-btn"
                    data-element-id="{{ element.id }}"
                    data-force="{{ Image ? 'true' : 'false' }}">
                {% if Image %}
                    {{ "Regenerate  Image"|t('-image-generator') }}
                {% else %}
                    {{ "Generate  Image"|t('-image-generator') }}
                {% endif %}
            </button>

            {% if Image %}
                <button type="button"
                        class="btn small -remove-btn"
                        data-element-id="{{ element.id }}">
                    {{ "Remove  Image"|t('-image-generator') }}
                </button>
            {% endif %}
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Generate  Image button
        document.querySelector('.-generate-btn')?.addEventListener('click', function(e) {
            const btn = e.target;
            const elementId = btn.dataset.elementId;
            const force = btn.dataset.force === 'true';

            btn.disabled = true;
            btn.textContent = '{{ "Generating..."|t('-image-generator') }}';

            fetch('{{ cpUrl('-image-generator/generate') }}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Requested-With': 'XMLHttpRequest',
                    'X-CSRF-Token': '{{ craft.app.request.csrfToken }}'
                },
                body: JSON.stringify({
                    elementId: elementId,
                    force: force
                })
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        Craft.cp.displayNotice('{{ " image generated successfully"|t('-image-generator') }}');
                        location.reload();
                    } else {
                        Craft.cp.displayError(data.message || '{{ "Failed to generate  image"|t('-image-generator') }}');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    Craft.cp.displayError('{{ "An error occurred"|t('-image-generator') }}');
                })
                .finally(() => {
                    btn.disabled = false;
                    btn.textContent = force ?
                        '{{ "Regenerate  Image"|t('-image-generator') }}' :
                        '{{ "Generate  Image"|t('-image-generator') }}';
                });
        });

        // Remove  Image button
        document.querySelector('.-remove-btn')?.addEventListener('click', function(e) {
            if (!confirm('{{ "Are you sure you want to remove the  image?"|t('-image-generator') }}')) {
                return;
            }

            const btn = e.target;
            const elementId = btn.dataset.elementId;

            // Implementation for remove functionality would go here
            // This would require an additional controller action
        });
    });
</script>

<style>
    .-image-preview .-image-content {
        padding: 14px 0;
    }

    .-image-thumbnail {
        margin-bottom: 10px;
    }

    .-image-actions .btn {
        margin-right: 5px;
        margin-bottom: 5px;
    }

    .-image-placeholder {
        padding: 20px;
        text-align: center;
        border: 2px dashed #e3e5e8;
        border-radius: 4px;
        margin-bottom: 10px;
    }
</style>